# GoUp 管理后台（admin-portal）

本目录包含管理后台的静态页面与脚本。当前实现基于原生 Vue 3 CDN 版本与简单静态服务器运行（无需打包）。

## 价格与校验规则
- 活动订单价格必须为整数（元），不支持小数。
- 在“活动表单”中，报名金额输入框已限制为整数并提供错误提示。
- 后端接口同样校验并拒绝非整数金额的订单。

## 运行方式

1. 启动静态文件服务（示例）：在 `admin-portal` 目录下运行 `python3 -m http.server 5501`。
2. 启动后端服务（可选，启用真实接口）：在 `server` 目录运行 `node src/index.js`，并根据 `.env` 配置数据库连接等。
3. 浏览器访问：`http://localhost:5501/index.html`

## 页面结构与入口

- 首页（`index.html`）：活动管理、会员管理、数据统计、积分支付规则；右侧有“支付异常监控”链接，跳转到独立页面。
- 支付异常监控（`errors.html`）：独立的异常查询与阈值管理页面，避免首页模板在挂载前解析造成的报错。

## 支付异常监控使用说明

1. 打开 `http://localhost:5501/errors.html`。
2. 管理员登录：输入用户名、密码，点击“登录”。
3. 数量限制：调整“数量限制”（服务器返回的总条数，最大200）。
4. 自动刷新：勾选“自动刷新”，设置“间隔(ms)”后自动定时拉取。
5. 分页查看：设置“每页数量”，使用“上一页/下一页”浏览。
6. 手动刷新：点击“手动刷新”立即获取最新记录。
7. 渠道筛选：通过“渠道”下拉框选择 `provider`（默认“全部”）。
8. 关键字搜索：在“搜索”输入框中输入关键词，支持在原因/详情/订单ID/渠道中模糊匹配（不区分大小写）。
9. CSV 导出：点击“导出CSV”下载当前筛选结果（导出所有匹配项，不仅当前页）。字段包含 `id, provider, orderId, reason, detail, createdAt`。

接口路由（后端）：`/api/admin/login`、`/api/payments/errors` 等详见 `server/src/index.js`。

## 备注

- 为提升稳定性，首页已移除内联的异常模块，仅保留导航链接至独立页。
- 若仅演示前端，无需启动后端；勾选“使用后端API”后再启用服务以体验真实数据。
 - 当前后端接口 `/api/payments/errors` 仅支持 `limit` 参数，分页为前端切片实现；筛选与搜索为前端实现。
 - 统一请求封装：`admin-portal/js/http.js` 会自动附带 `Authorization` 并在 `401/403` 时派发 `admin-auth-expired`；默认基地址为 `http://localhost:3000/api`（可通过 `window.HTTP_API_BASE` 覆盖）。
