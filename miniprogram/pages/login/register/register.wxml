<view class="page">
  <!-- 头像与个人信息标题 -->
  <view class="profile-header">
    <text class="profile-title">个人信息</text>
    <view class="avatar" bindtap="onChooseAvatar">
      <image class="avatar-img" src="{{avatarUrl ? avatarUrl : defaultAvatar}}" mode="aspectFill"></image>
      <text class="avatar-tip">点击上传头像（必填）</text>
    </view>
  </view>
  <view class="form card">
    <view class="field">
      <text class="label">用户名*</text>
      <input class="input" placeholder="请输入用户名（至少3位）" placeholder-style="text-align:right;font-size:22rpx;" bindinput="onInput" data-field="username" value="{{username}}"/>
    </view>
    <view class="field">
      <text class="label">密码*</text>
      <input class="input {{password ? 'align-left' : 'align-right'}}" password="{{!showPassword}}" placeholder="8-20位，含字母+数字" placeholder-style="text-align:right;font-size:22rpx;" bindinput="onInput" data-field="password" value="{{password}}"/>
      <image class="toggle {{showPassword?'on':''}}" src="{{eyeIcon}}" mode="aspectFit" bindtap="toggle" data-target="showPassword"/>
    </view>
    <view class="field">
      <text class="label">确认密码*</text>
      <input class="input {{confirm ? 'align-left' : 'align-right'}}" password="{{!showConfirm}}" placeholder="再次输入密码" placeholder-style="text-align:right;font-size:22rpx;" bindinput="onInput" data-field="confirm" value="{{confirm}}"/>
      <image class="toggle {{showConfirm?'on':''}}" src="{{eyeIcon}}" mode="aspectFit" bindtap="toggle" data-target="showConfirm"/>
    </view>
    <!-- 基本信息字段（不显示“基本信息”标题） -->
    <view class="field">
      <text class="label">英文名*</text>
      <input class="input" placeholder="如：Alice" placeholder-style="text-align:right;font-size:22rpx;" bindinput="onInput" data-field="nameEn" value="{{nameEn}}"/>
    </view>
    <view class="field">
      <text class="label">性别*</text>
      <radio-group class="radio-group" bindchange="onGenderChange">
        <label class="radio"><radio value="女" checked="{{gender==='女'}}" color="#7c3aed"/>女</label>
        <label class="radio"><radio value="男" checked="{{gender==='男'}}" color="#7c3aed"/>男</label>
      </radio-group>
    </view>
    <view class="field">
      <text class="label">年龄*</text>
      <input class="input" type="number" placeholder="请输入年龄" placeholder-style="text-align:right;font-size:22rpx;" bindinput="onInput" data-field="age" value="{{age}}"/>
    </view>
    <view class="field">
      <text class="label">地区/国家*</text>
      <view class="country-selector">
        <picker mode="multiSelector" range="{{multiArray}}" value="{{multiIndex}}" bindchange="onRegionCountryChange" bindcolumnchange="onRegionCountryColumnChange">
          <view class="picker-display {{nation ? '' : 'placeholder'}}">
            {{ nation ? (regionName + ' / ' + nation) : '请选择地区/国家' }}
          </view>
        </picker>
        <view class="search-trigger" bindtap="onOpenCountrySearch">
          <image class="search-icon" src="/assets/search.png" mode="aspectFit"></image>
          <text class="search-text">搜索选择</text>
        </view>
      </view>
    </view>

    <view class="field">
      <text class="label">语言</text>
      <input class="input" placeholder="如：中文/English" placeholder-style="text-align:right;font-size:22rpx;" bindinput="onInput" data-field="language" value="{{language}}"/>
    </view>
    <view class="field">
      <text class="label">职业</text>
      <input class="input" placeholder="选填" placeholder-style="text-align:right;font-size:22rpx;" bindinput="onInput" data-field="occupation" value="{{occupation}}"/>
    </view>
    <view class="field">
      <text class="label">城市</text>
      <input class="input" placeholder="选填" placeholder-style="text-align:right;font-size:22rpx;" bindinput="onInput" data-field="city" value="{{city}}"/>
    </view>
    <view class="field">
      <text class="label">喜欢的类型</text>
      <input class="input" placeholder="如：露营/路跑" placeholder-style="text-align:right;font-size:22rpx;" bindinput="onInput" data-field="favorite" value="{{favorite}}"/>
    </view>
  </view>

  <!-- 邀码与协议 -->
  <view class="extra">
    <view class="field">
      <text class="label">邀请码</text>
      <input class="input" placeholder="选填" placeholder-style="text-align:right;font-size:22rpx;" bindinput="onInput" data-field="inviteCode" value="{{inviteCode}}"/>
    </view>
    <view class="agreements">
      <checkbox-group bindchange="onAgreementChange">
        <label class="agreement-item">
          <checkbox value="payment" checked="{{agreePaymentRules}}"/> 向上GO-UP小程序支付、退款与积分规则
          <text class="view-link" catchtap="onViewDoc" data-key="payment">查看</text>
        </label>
        <label class="agreement-item">
          <checkbox value="user" checked="{{agreeUserAgreement}}"/> 向上GO-UP小程序用户使用协议及平台法律规则
          <text class="view-link" catchtap="onViewDoc" data-key="user">查看</text>
        </label>
      </checkbox-group>
    </view>
  </view>
  <view wx:if="{{searchCountryVisible}}" class="country-search-overlay">
    <view class="overlay-card">
      <view class="overlay-header">
        <text class="overlay-title">选择国家</text>
        <view class="overlay-close" bindtap="onCloseCountrySearch">取消</view>
      </view>
      <input class="search-input" placeholder="输入国家或地区关键字" value="{{searchQuery}}" bindinput="onSearchInput"/>
      <scroll-view class="result-list" scroll-y="true">
        <block wx:for="{{searchResults}}" wx:key="code">
          <view class="result-item" bindtap="onPickCountryFromSearch" data-region="{{item.region}}" data-name="{{item.name}}" data-code="{{item.code}}">
            <text class="result-flag">{{item.flag}}</text>
            <text class="result-name">{{item.name}}</text>
            <text class="result-region">{{item.region}}</text>
          </view>
        </block>
      </scroll-view>
    </view>
  </view>
  <view wx:if="{{docOverlayVisible}}" class="doc-overlay">
    <view class="doc-card">
      <view class="doc-header">
        <text class="doc-title">{{docTitle}}</text>
        <view class="doc-close" bindtap="onCloseDoc" aria-label="关闭">
          <text class="doc-close-icon">X</text>
        </view>
      </view>
      <scroll-view class="doc-body" scroll-y="true">
        <text class="doc-text">{{docContent}}</text>
      </scroll-view>
    </view>
  </view>
  <view class="bottom-space"></view>

  <view class="footer">
    <button class="primary" bindtap="onSubmit">提交并注册</button>
  </view>
</view>